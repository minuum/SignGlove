[supervisord]
nodaemon=true
user=signglove
logfile=/var/log/signglove/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/var/log/signglove/

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700
chown=signglove:signglove

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# SignGlove FastAPI 서버
[program:signglove-server]
command=poetry run uvicorn server.main:app --host 0.0.0.0 --port 8000 --workers 4
directory=/opt/signglove
user=signglove
autostart=true
autorestart=true
startsecs=5
startretries=3
redirect_stderr=true
stdout_logfile=/var/log/signglove/server.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=3
environment=PYTHONPATH="/opt/signglove",ENVIRONMENT="production"

# 메트릭스 수집 서버 (선택사항)
[program:signglove-metrics]
command=poetry run python -m prometheus_client --port 9090
directory=/opt/signglove
user=signglove
autostart=false
autorestart=true
startsecs=3
redirect_stderr=true
stdout_logfile=/var/log/signglove/metrics.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=2

# 데이터 백업 작업 (주기적 실행)
[program:signglove-backup]
command=poetry run python scripts/backup_data.py --interval 3600
directory=/opt/signglove
user=signglove
autostart=true
autorestart=true
startsecs=10
redirect_stderr=true
stdout_logfile=/var/log/signglove/backup.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=2

# 로그 로테이션 작업
[program:signglove-logrotate]
command=poetry run python scripts/log_rotator.py --interval 86400
directory=/opt/signglove
user=signglove
autostart=true
autorestart=true
startsecs=10
redirect_stderr=true
stdout_logfile=/var/log/signglove/logrotate.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=1

# 시스템 모니터링
[program:signglove-monitor]
command=poetry run python scripts/system_monitor.py --interval 300
directory=/opt/signglove
user=signglove
autostart=true
autorestart=true
startsecs=15
redirect_stderr=true
stdout_logfile=/var/log/signglove/monitor.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=2

[group:signglove]
programs=signglove-server,signglove-backup,signglove-logrotate,signglove-monitor
priority=999 