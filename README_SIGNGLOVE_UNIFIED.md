# 🤟 SignGlove 통합 수어 데이터 수집기

**한국어 수어 34개 클래스 대응 실시간 데이터 수집 시스템**

## 🎯 주요 특징

### ✨ 완전한 통합 시스템
- **34개 한국어 수어 클래스**: 자음 14개 + 모음 10개 + 숫자 10개
- **실시간 하드웨어 연동**: Arduino Nano 33 IoT + LSM6DS3 센서
- **ROS2 스타일 인터페이스**: 키보드 기반 직관적 조작
- **진행률 추적**: 클래스별 목표 설정 및 자동 통계

### 📊 센서 데이터 구성
```
timestamp,pitch,roll,yaw,accel_x,accel_y,accel_z,flex1,flex2,flex3,flex4,flex5
5285,1.33,0.11,0.01,-0.023,0.002,1.009,700,850,720,690,780
```

**센서 사양:**
- **Flex 센서**: 5개 (각 손가락, 0-1023 ADC)
- **IMU 센서**: 6축 (자이로스코프 + 가속도계)
- **샘플링 주파수**: 가변 (기본 4Hz, 최대 500Hz)
- **실시간 Hz 측정**: 아두이노 타임스탬프 기반 정확한 주기 계산

## 🚀 사용법

### 1. 환경 설정
```bash
# Poetry 환경 활성화
poetry shell

# 의존성 설치 (이미 완료된 경우 생략)
poetry install
```

### 2. 수집기 실행
```bash
python scripts/signglove_unified_collector.py
```

### 3. 조작 방법

#### 기본 명령어
```
C: 시리얼 포트 연결/재연결
N: 새 에피소드 시작 (클래스 선택)
M: 현재 에피소드 종료
P: 진행 상황 확인
R: 진행률 재계산 (H5 파일 스캔)
Q: 프로그램 종료
```

#### 수집 워크플로우
1. **'C' 키**: 아두이노 연결
2. **'N' 키**: 클래스 선택 메뉴 표시
3. **숫자키 (1-34)**: 원하는 수어 클래스 선택
4. **수어 동작 수행**: 3-5초간 자연스러운 동작
5. **'M' 키**: 에피소드 완료 및 저장

## 🎯 34개 한국어 수어 클래스

### 자음 (14개) - 우선순위 1
```
ㄱ ㄴ ㄷ ㄹ ㅁ ㅂ ㅅ ㅇ ㅈ ㅊ ㅋ ㅌ ㅍ ㅎ
```

### 모음 (10개) - 우선순위 2
```
ㅏ ㅑ ㅓ ㅕ ㅗ ㅛ ㅜ ㅠ ㅡ ㅣ
```

### 숫자 (10개) - 우선순위 3
```
0 1 2 3 4 5 6 7 8 9
```

### 수집 목표
- **기본 자음 (ㄱㄴㄷㄹㅁ)**: 각 100개 에피소드
- **확장 자음/기본 모음**: 각 80개 에피소드  
- **복합 모음/숫자**: 각 50-60개 에피소드
- **총 목표**: 약 2,400개 에피소드

## 📁 데이터 구조

### 저장 형식
```
data/signglove_unified/
├── episode_20250128_143052_ㄱ.h5
├── episode_20250128_143125_ㄴ.h5
├── collection_progress.json
└── ...
```

### H5 파일 구조 (KLP-SignGlove 호환)
```python
{
    # 메타데이터
    'class_name': 'ㄱ',
    'class_category': 'consonant',
    'num_samples': 67,
    'avg_sampling_rate': 4.2,
    
    # 센서 데이터
    'sensor_data': (67, 8),        # flex(5) + orientation(3)
    'sensors/flex': (67, 5),       # 플렉스 센서
    'sensors/orientation': (67, 3), # pitch, roll, yaw
    'sensors/acceleration': (67, 3), # accel_x, accel_y, accel_z
    
    # 타임스탬프
    'timestamps': (67,),           # PC 수신 시각
    'arduino_timestamps': (67,),   # 아두이노 millis()
    'sampling_rates': (67,)        # 실시간 Hz
}
```

## 🔧 하드웨어 설정

### Arduino 펌웨어
파일: `external/SignGlove_HW/imu_flex_serial.ino`

**주요 기능:**
- LSM6DS3 IMU 센서 (자이로스코프 + 가속도계)
- 플렉스 센서 5개 (A0, A1, A2, A3, A6)
- 가변 샘플링 주기 (2ms ~ 무제한)
- USB CDC 연결 상태 감지
- 시리얼 명령어 지원: `interval,50`, `header`, `flush`

### 회로 연결
```
Arduino Nano 33 IoT:
├── A0-A6: 플렉스 센서 (전압 분배기)
├── LSM6DS3: I2C 연결 (내장)
└── USB: 시리얼 통신 (115200 baud)
```

## 📊 데이터 품질

### KLP-SignGlove와의 호환성
- **센서 구성**: 동일 (flex 5개 + IMU 6축)
- **데이터 형식**: 호환 (8채널 메인 데이터)
- **정규화**: MinMax (flex), Z-score (IMU) 지원
- **윈도우 크기**: 20샘플 (기본값)

### 데이터 검증
- **실시간 Hz 모니터링**: 데이터 품질 확인
- **타임스탬프 이중 기록**: PC/아두이노 시각 동기화
- **센서 범위 검증**: Flex(0-1023), IMU(-180°~+180°)

## 🎮 진행률 관리

### 자동 통계 추적
- 클래스별 수집 현황 실시간 표시
- 세션별 수집량 추적
- H5 파일 스캔으로 정확한 재계산

### 우선순위 기반 수집
```
🔥 우선순위 1: ㄱㄴㄷㄹㅁ (기본 자음)
⭐ 우선순위 2: 기본 모음 + 확장 자음  
📝 우선순위 3: 복합 모음 + 숫자
```

## 🔍 문제 해결

### 자주 발생하는 문제

1. **아두이노 연결 실패**
   ```bash
   # 포트 확인
   ls /dev/tty*
   # macOS: /dev/cu.usbmodem*
   # Linux: /dev/ttyUSB*, /dev/ttyACM*
   ```

2. **데이터 수신 오류**
   - 헤더 확인: `timestamp,pitch,roll,yaw,accel_x,accel_y,accel_z,flex1,flex2,flex3,flex4,flex5`
   - 필드 수 확인: 12개 필드 필요

3. **플렉스 센서 값 (700-900 범위)**
   - 정상 범위 (저항 분배기 설계)
   - 개별 센서 캘리브레이션 권장

### 로그 분석
```
📊 수집 중... 40개 샘플 (현재: 4.2Hz)
✅ 에피소드 완료: 'ㄱ'
📈 진행률: 85/100 (85.0%) - 15개 남음
```

## 🔮 다음 단계

1. **ML 모델 훈련**: KLP-SignGlove 딥러닝 파이프라인 활용
2. **실시간 추론**: 562 FPS 성능 목표
3. **TTS 통합**: 한국어 음성 합성 연동
4. **성능 최적화**: 센서 융합 및 정확도 개선

---

**💡 팁**: 자연스러운 수어 동작으로 3-5초간 수집하면 최적의 데이터 품질을 얻을 수 있습니다!
